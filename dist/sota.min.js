!function(t,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a(require("d3")):"function"==typeof define&&define.amd?define(["d3"],a):(t=t||self).sota=a(t.d3)}(this,(function(t){"use strict";var a={separatorStrokeWidth:1,barHeight:32,barMargin:16,labelLeft:6,labelBelow:8,groupLabelMargin:32,xAxisTop:24,overflowOffset:24,lineColor:"#777777",labelColor:"#777777",mainHeight:300,tickSize:4,labelAngle:30,groupedBarChart:{barHeight:24,barMargin:8},margin:{top:20,bottom:20,left:0,right:0},swatch:{between:12,belowBetween:8,right:24,width:32,height:24,below:16}};function e(a){const e=a.node().offsetWidth/2,n=t.event.pageX;return n-e<0?e:n+e>window.innerWidth?window.innerWidth-e:n}function n(a){return t.format(".1f")(a)+"%"}function l(l,s,r,o,i){l.on("mouseover",(function(l,c){t.select(this).attr("opacity",a.hoverOpacity),s.style("opacity",1).html(()=>{let t=`<span class="sota-text-label"></span><span class="sota-heavy-label">${o[c]}</span><br/>Percentage: ${n(r[c])}`;return i&&(t+="<br/>Number of responses: "+i[c]),t+="</span>",t}).style("left",e(s)+"px").style("top",t.event.pageY+"px")})).on("mousemove",a=>{s.style("left",e(s)+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(a){t.select(this).attr("opacity",1),s.style("opacity",0)}))}function s(a,e,n=null){return n=null==n?t.sum(a,t=>+t.value):n,[e?a.map(t=>+t.value).keys:a.map(t=>+t.value/n*100),!e&&a.map(t=>+t.value),a.map(t=>t.label)]}function r(t,a){for(let e of t._groups)if(Array.isArray(e))for(let t of e)o(t,a);else o(e,a)}function o(t,a){t.getBBox().x<a&&(t.style.display="none")}let i={barChart:function({selector:e,dataFile:r,inputIsPercentage:o=!1,showXAxis:i=!0,showSeparators:c=!0,displayPercentage:h=!0,totalResp:d=null,maxVal:g=null,minVal:p=null,margin:f=a.margin}){const m=a.tickSize,x=a.separatorStrokeWidth,u=a.labelLeft,b=a.barHeight,y=a.barMargin,w=a.overflowOffset,v=a.xAxisTop,B=t.select(e).append("svg"),k=t.select("body").append("div").attr("class","tooltip"),C=document.querySelector(e).offsetWidth,A=C-f.left-f.right,$=B.append("g").attr("class","sota-barChart-mainChart").attr("transform",`translate(${f.left+w} ${f.right})`).attr("width",A);t.csv(r+".csv").then(a=>{const r=b+y;let j=a.length*r;const[G,M,S]=s(a,o,d),L=h||o?G:M;if(null==p)p=o||h?0:t.min(L);else if(!0===p)p=t.min(L);else if(isNaN(p)||""===p)throw"invalid minVal for graph on "+e;if(null==g)g=o||h?100:t.max(L);else if(!0===g)g=t.max(L);else if(isNaN(g)||""===g)throw"invalid maxVal for graph on "+e;const P=t.scaleLinear().domain([p,g]).range([0,A]);let N;function T(t){return t*r}if(i&&(N=$.append("g").attr("class","sota-gen-axis sota-gen-xAxis sota-num-axis").call(t.axisBottom(P).tickSize(-m)).attr("transform","translate(0 "+(j+v)+")")),$.selectAll(".sota-barChart-bar").data(L).join("rect").attr("class","sota-barChart-bar sota-gen-bar").attr("width",t=>P(t)).attr("height",b).attr("x",0).attr("y",(t,a)=>T(a)),$.selectAll(".sota-barChart-hiddenBar").data(L).join("rect").attr("class","sota-barChart-hiddenBar").attr("width",A).attr("height",b).attr("x",0).attr("y",(t,a)=>T(a)).attr("fill","transparent").call(l,k,G,S,M),$.selectAll(".sota-barChart-label").data(a).join("text").attr("class","sota-barChart-label sota-text-label sota-heavy-label").html(t=>t.label).attr("alignment-baseline","central").attr("x",u).attr("y",(t,a)=>T(a)+b/2),c&&$.selectAll(".sota-barChart-separator").data(L).join("line").attr("class","sota-barChart-separator").attr("x1",0).attr("x2",A).attr("y1",(t,a)=>T(a)+b+6).attr("y2",(t,a)=>T(a)+b+6).attr("stroke-width",x).attr("stroke","#dddddd"),$.selectAll(".sota-barChart-value").data(L).join("text").attr("class","sota-barChart-value sota-num-label").html((t,a)=>o||h?n(t):t).attr("alignment-baseline","central").attr("text-anchor","end").attr("x",A).attr("y",(t,a)=>T(a)+b/2),i){let a=[];N.selectAll("text").each((function(){a.push(this.getBBox().y+this.getBBox().height)})),j+=+t.max(a)}const W=j+f.top+f.bottom;B.style("width",C+2*w+"px").attr("height",W).style("margin-left",-w)})},pieChart:function({selector:e,dataFile:r,inputIsPercentage:o=!1,pieRad:i=150,pieThick:c=80,margin:h=a.margin}){const d=a.lineColor,g=a.separatorStrokeWidth,p=a.separatorStrokeWidth,f=a.swatch.between,m=a.swatch.right,x=a.swatch.width,u=a.swatch.height,b=a.swatch.belowBetween,y=a.swatch.below,w=a.overflowOffset,v=t.select(e),B=v.append("svg"),k=t.select("body").append("div").attr("class","tooltip"),C=v.node().offsetWidth,A=C-h.left-h.right,$=B.append("g").attr("class","sota-barChart-mainChart").attr("transform",`translate(${h.left+w} ${h.right})`).attr("width",A);A<2*i&&(i=A/2),c>i&&(c=50),h.top,h.bottom,t.csv(r+".csv").then(a=>{const[e,r,v]=s(a,o),j=t.pie()(e);let G=0,M=[];const S=t.scaleOrdinal().domain(v).range(t.map(v,(t,a)=>"module-fill-"+(a+1)).keys()),L=$.append("g").lower().attr("class","sota-gen-legend").attr("transform",`translate(0 ${h.top})`);if(L.selectAll("nothing").data(a).enter().append("text").attr("class","sota-gen-legend-text").text(t=>t.label).attr("x",(function(){M.push(this.getBBox().width)})).remove(),t.sum(M,t=>t)+3*f+2*m>A){let a=A-t.max(M)-x-f;L.selectAll(".sota-gen-legend-swatch").data(v).join("rect").attr("class",t=>"sota-gen-legend-swatch "+S(t)).attr("x",a).attr("y",(t,a)=>(u+b)*a).attr("width",x).attr("height",u),L.selectAll(".sota-gen-legend-text").data(v).join("text").attr("class","sota-gen-legend-text sota-text-label sota-heavy-label").text(t=>t).attr("x",a+x+f).attr("y",(t,a)=>(u+b)*a+u/2).attr("alignment-baseline","central"),G=v.length*u+(v.length-1)*b+y}else{let a=A-(t.sum(M,t=>t)+v.length*(x+f)+(v.length-1)*m);L.selectAll(".sota-gen-legend-swatch").data(v).join("rect").attr("class",t=>"sota-gen-legend-swatch "+S(t)).attr("x",(e,n)=>a+n*(x+f+m)+t.sum(M.slice(0,n),t=>t)).attr("y",0).attr("width",x).attr("height",u),L.selectAll(".sota-gen-legend-text").data(v).join("text").attr("class","sota-gen-legend-text sota-text-label sota-heavy-label").text(t=>t).attr("x",(e,n)=>a+n*(x+f+m)+x+f+t.sum(M.slice(0,n),t=>t)).attr("y",u/2).attr("alignment-baseline","central"),G=u+y}const P=$.append("g").attr("transform","translate("+A/2+","+(i+G)+")"),N=t.arc().innerRadius(.8*i-.8*c).outerRadius(.8*i),T=t.arc().innerRadius(.9*i).outerRadius(.9*i);P.selectAll(".sota-pieChart-slice").data(j).join("path").attr("class",(t,a)=>"sota-pieChart-slice module-fill-"+(a+1)).attr("d",N).attr("stroke","#fff").style("stroke-width",p).call(l,k,e,v,r),P.selectAll(".sota-pieChart-polyline").data(j).join("polyline").attr("class","sota-pieChart-polyline").attr("stroke",d).style("fill","none").attr("stroke-width",g).attr("points",t=>{let a=N.centroid(t),e=T.centroid(t),n=T.centroid(t),l=t.startAngle+(t.endAngle-t.startAngle)/2;return n[0]=.95*i*(l<Math.PI?1:-1),[a,e,n]}),P.selectAll(".sota-pieChart-label").data(j).join("text").attr("class","sota-pieChart-label sota-num-label").text((t,a)=>n(e[a])).attr("alignment-baseline","central").attr("transform",t=>{let a=T.centroid(t),e=t.startAngle+(t.endAngle-t.startAngle)/2;return a[0]=.99*i*(e<Math.PI?1:-1),"translate("+a+")"}).style("text-anchor",t=>t.startAngle+(t.endAngle-t.startAngle)/2<Math.PI?"start":"end");const W=2*i+G+h.top+h.bottom;B.style("width",C+2*w+"px").attr("height",W).style("margin-left",-w)})},lineGraph:function({selector:e,dataFile:l,inputIsPercentage:s=!1,minVal:r=null,maxVal:o=null,height:i=300,customTooltipAppend:c="",prop5:h="value5",prop6:d="value6",margin:g={top:20,bottom:20,left:24,right:0}}){const p=t.select(e).append("svg").attr("class","sota-lineGraph"),f=t.select("body").append("div").attr("class","tooltip"),m=document.querySelector(e).offsetWidth;p.attr("height",i),t.csv(l+".csv").then(l=>{const c=a.separatorStrokeWidth,h=l.map(t=>t.label),d=l.map(t=>+t.value);if(null==r)r=s?0:t.min(l,t=>t.value);else if(1==r)r=t.min(l,t=>t.value);else if(isNaN(r)||""==r)throw"invalid minVal for graph on "+e;if(null==o)o=s?100:t.max(l,t=>t.value);else if(1==o)o=t.max(l,t=>t.value);else if(isNaN(o)||""==o)throw"invalid maxVal for graph on "+e;const x=t.scaleBand().domain(h.map(t=>t)).range([g.left,m-g.right]),u=t.scaleLinear().domain([r,o]).range([i-g.bottom,g.top]);p.append("g").attr("class","sota-gen-axis sota-gen-xAxis sota-text-axis").call(t.axisBottom(x).ticks(l.length).tickSize(-8)).style("transform","translateY("+(i-g.bottom)+"px)"),p.append("g").attr("class","sota-gen-axis sota-gen-YAxis sota-num-axis").call(t.axisLeft(u).tickSize(-8)).style("transform","translateX("+g.left+"px)"),p.selectAll(".sota-lineGraph-path").data([d]).join("path").attr("class","sota-lineGraph-path").attr("d",t.line().x((t,a)=>x(h[a])+x.bandwidth()/2).y(t=>u(t))).attr("fill","none").attr("stroke","#bbb").style("stroke-width",3),p.selectAll(".sota-lineGraph-circle").data(d).join("circle").attr("class","sota-lineGraph-circle").attr("cx",(t,a)=>x(h[a])+x.bandwidth()/2).attr("cy",t=>u(t)).attr("r",9).attr("stroke","white").style("stroke-width",c).on("mouseover",(function(a,e){t.select(this).attr("opacity",.8),f.style("opacity",1).html(`<span class="sota-tooltip-label">${h[e]}</span><br/>Value: `+(s?n(a):a)+"</span>").style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")})).on("mousemove",a=>{f.style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(a){t.select(this).attr("opacity",1),f.style("opacity",0)})),p.selectAll(".sota-lineGraph-label").data(d).join("text").attr("class","sota-lineGraph-label sota-num-label").text((t,a)=>{if(s)return t+"%"}).attr("x",(t,a)=>x(h[a])+x.bandwidth()/2).attr("y",t=>u(t)-16).style("text-anchor","middle")})},stackedBarChart:function({selector:e,dataFile:l,inputIsPercentage:s=!1,showXAxis:o=!0,labelStyle:i="onBar",groupLabelStyle:c="none",showLegend:h=!0,prop5:d="value5",prop6:g="value6",margin:p=a.margin}){const f=a.separatorStrokeWidth,m=a.barHeight,x=a.barMargin,u=a.overflowOffset,b=a.groupLabelMargin,y=a.labelLeft,w=a.labelBelow,v=a.lineColor,B=a.swatch.between,k=a.swatch.right,C=a.swatch.width,A=a.swatch.height,$=a.swatch.belowBetween,j=a.swatch.below,G=a.xAxisTop;var M=t.select(e).append("svg"),S=t.select("body").append("div").attr("class","tooltip"),L=document.querySelector(e).offsetWidth,P=L-p.left-p.right;const N=M.append("g").attr("class","sota-stackedBarChart-mainChart").attr("transform",`translate(${p.left+u} ${p.right})`).attr("width",P);t.csv(l+".csv").then(a=>{var e=m+x,l=a.length*e,d=0;"onBar"==c&&(e+=a.length*b,l+=a.length*b,d=b);const g=a.columns.slice(1),T=t.map(a,t=>t.group).keys();var W=[];s?a.forEach(t=>{let a=0,e=[];for(let n of g){let l=+t[n];e.push([l,a]),a+=l}W.push(e)}):a.forEach(a=>{let e=0,n=t.sum(g,t=>+a[t]),l=[];for(let t of g){let s=+a[t]/n*100;l.push([s,e,+a[t]]),e+=s}W.push(l)});const V=t.scaleBand().domain(T).range([0,l]).padding([.2]),I=t.scaleLinear().domain([0,100]).range([0,P]),z=t.scaleOrdinal().domain(g).range(t.map(g,(t,a)=>"module-fill-"+(a+1)).keys());o&&(N.append("g").attr("class","sota-gen-axis sota-gen-xAxis sota-num-axis").call(t.axisBottom(I).ticks(a.length).tickSize(-8)).attr("transform","translate(0 "+(l+G)+")"),l+=20+G);var O=0;if(h){let a=[];const e=M.append("g").lower().attr("class","sota-gen-legend").attr("transform",`translate(0 ${p.top})`);if(e.selectAll("nothing").data(g).enter().append("text").attr("class","sota-gen-legend-text").text(t=>t).attr("x",(function(){a.push(this.getBBox().width)})).remove(),t.sum(a,t=>t)+3*B+2*k>P){let n=P-t.max(a)-C-B;e.selectAll(".sota-gen-legend-swatch").data(g).join("rect").attr("class",t=>"sota-gen-legend-swatch "+z(t)).attr("x",n).attr("y",(t,a)=>(A+$)*a).attr("width",C).attr("height",A),e.selectAll(".sota-gen-legend-text").data(g).join("text").attr("class","sota-gen-legend-text sota-text-label sota-heavy-label").text(t=>t).attr("x",n+C+B).attr("y",(t,a)=>(A+$)*a+A/2).attr("alignment-baseline","central"),O=g.length*A+(g.length-1)*$+j}else{let n=P-(t.sum(a,t=>t)+g.length*(C+B)+(g.length-1)*k);e.selectAll(".sota-gen-legend-swatch").data(g).join("rect").attr("class",t=>"sota-gen-legend-swatch "+z(t)).attr("x",(e,l)=>n+l*(C+B+k)+t.sum(a.slice(0,l),t=>t)).attr("y",0).attr("width",C).attr("height",A),e.selectAll(".sota-gen-legend-text").data(g).join("text").attr("class","sota-gen-legend-text sota-text-label sota-heavy-label").text(t=>t).attr("x",(e,l)=>n+l*(C+B+k)+C+B+t.sum(a.slice(0,l),t=>t)).attr("y",A/2).attr("alignment-baseline","central"),O=A+j}}const Y=N.selectAll(".sota-stackedBarChart-group").data(W).join("g").attr("class","sota-stackedBarChart-group").attr("transform",(t,a)=>"translate(0 "+(V(T[a])+d-x)+")");Y.selectAll(".sota-stackedBarChart-bar").data(t=>t).join("rect").attr("class",(t,a)=>"sota-stackedBarChart-bar "+z(a)).attr("x",t=>I(t[1])).attr("y",0).attr("width",t=>I(t[0])).attr("height",m).on("mouseover",(function(a,e){t.select(this).attr("opacity",.8),S.style("opacity",1).html(()=>{let t=`<span class="sota-text-label"><span class="sota-heavy-label">${g[e]}</span><br/>Percentage: ${n(a[0])}`;return s||(t+="<br/>Number of responses: "+a[2]),t+="</span>",t}).style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")})).on("mousemove",()=>{S.style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(a){t.select(this).attr("opacity",1),S.style("opacity",0)})),Y.selectAll(".sota-stackedBarChart-separator").data(t=>t).join("rect").attr("class","sota-stackedBarChart-separator").attr("fill","white").attr("x",t=>I(t[1])+I(t[0])).attr("y",0).attr("width",t=>t[0]>0?f:0).attr("height",m),"onBar"==c&&N.selectAll(".sota-stackedBarChart-groupLabel-onBar").data(T).join("text").attr("class","sota-stackedBarChart-groupLabel-onBar sota-text-label").text(t=>t).attr("alignment-baseline","bottom").attr("x",0).attr("y",t=>V(t));var X=0;if("onBar"==i)Y.selectAll(".sota-stackedBarChart-label-onBar").data(t=>t).join("text").attr("class","sota-stackedBarChart-label-onBar sota-num-label").text(a=>t.format(".1f")(a[0])+"%").attr("alignment-baseline","central").attr("text-anchor","end").attr("x",t=>I(t[1])+I(t[0])-y).attr("y",m/2).call(r,p.left);else if("aboveBar"==i){var H=[];Y.selectAll(".sota-stackedBarChart-label-aboveBar-text").data(t=>t).join("text").attr("class","sota-stackedBarChart-label-aboveBar-text sota-num-label").text((a,e)=>`${g[e]}: ${t.format(".1f")(a[0])}%`).attr("x",t=>I(t[1])+I(t[0])/2).attr("y",(function(t){return H.push([this.getBBox().x,this.getBBox().width]),-2*w})).attr("alignment-baseline","bottom");let a=[];!function t(e){if(e==H.length-1)return a[e]=-2,-2;if(H[e][0]+H[e][1]+y>H[e+1][0]){H[e+1][0]=H[e][0]+H[e][1]+y;let n=t(e+1)-1;return a[e]=n,n}return t(e+1),a[e]=-2,-2}(0),Y.selectAll(".sota-stackedBarChart-label-aboveBar-line").data(t=>t).join("polyline").attr("class","sota-stackedBarChart-label-aboveBar-line").attr("points",(t,e)=>{let n=I(t[1])+I(t[0])/2,l=m/2,s=n,r=(a[e]+1)*w;return`${n},${l} ${s},${r} ${H[e][0]+H[e][1]},${r}`}).attr("stroke-width",f).attr("stroke",v).attr("fill","none"),Y.selectAll(".sota-stackedBarChart-label-aboveBar-text").data(t=>t).join("text").attr("x",(t,a)=>H[a][0]).attr("y",(t,e)=>a[e]*w),X=-1*t.min(a)*w+20}const F=l+p.top+p.bottom+O+X;M.style("width",L+2*u+"px").attr("height",F).style("margin-left",-u),N.attr("transform",`translate(${u} ${p.top+O+X})`).attr("width",P)})},customBarChart:function({selector:e,dataFile:r,shapeFile:o,shapeWidth:i=300,inputIsPercentage:c=!1,margin:h=a.margin}){var d=t.select(e).append("svg"),g=t.select("body").append("div").attr("class","tooltip");const p=d.append("g").attr("class","sota-mainChart");var f=document.querySelector(e).offsetWidth;const m=a.separatorStrokeWidth,x=a.labelLeft,u=a.labelBelow,b=a.lineColor;t.xml("shapes/"+o+".svg").then(a=>{let e=document.importNode(a.documentElement,!0),o=t.select(e).select("path").node(),y=0,w=0;d.append(()=>o).attr("class",(function(){return y=this.getBBox().width,w=this.getBBox().height,""})).remove();let v=i/y,B=w*v;d.append("defs").append("clipPath").attr("id","shapeDef").append(()=>o).attr("transform",`scale(${v})`),t.csv(r+".csv").then(a=>{const[e,r,o]=s(a,c);let y=0,w=[];for(let t of a)w.push(y),y+=+t.value;const v=t.scaleLinear().domain([0,t.sum(a,t=>+t.value)]).range([0,i]),k=t.scaleOrdinal().domain(t.map(a,t=>t.label)).range(t.map(a,(t,a)=>"module-fill-"+(a+1)).keys());p.selectAll(".sota-customBarChart-bar").data(a).join("rect").attr("class",t=>"sota-customBarChart-bar "+k(t.label)).attr("x",(t,a)=>v(w[a])).attr("y",0).attr("width",t=>v(t.value)).attr("height",B).attr("clip-path","url(#shapeDef)").call(l,g,e,o,r),p.selectAll(".sota-customBarChart-separator").data(a).join("rect").attr("class","sota-customBarChart-separator").attr("x",(t,a)=>0==a?-m:v(w[a])).attr("y",0).attr("width",m).attr("height",B).attr("fill","white").attr("clip-path","url(#shapeDef)");var C=[];p.selectAll(".sota-customBarChart-label-aboveBar-text").data(a).join("text").attr("class","sota-customBarChart-label-aboveBar-text").html((t,a)=>`<tspan class="sota-text-label sota-heavy-label">${t.label}:</tspan><tspan class="sota-num-label"> ${n(e[a])}</tspan>`).attr("x",(t,a)=>v(w[a])+v(t.value)/2+x).attr("y",(function(t){return C.push([this.getBBox().x,this.getBBox().width]),B+3*u})).attr("alignment-baseline","top");let A=[];!function t(a){if(a==C.length-1)return A[a]=3,3;if(C[a][0]+C[a][1]+2*x>C[a+1][0]){C[a+1][0]=C[a][0]+C[a][1]+2*x;let e=t(a+1)+1;return A[a]=e,e}return t(a+1),A[a]=3,3}(0),p.selectAll(".sota-customBarChart-label-aboveBar-line").data(a).join("polyline").attr("class","sota-customBarChart-label-aboveBar-line").attr("points",(t,a)=>{let e=v(w[a])+v(t.value)/2,n=B-u,l=e,s=B+(A[a]+1)*u;return`${e},${n} ${l},${s} ${C[a][0]+C[a][1]},${s}`}).attr("stroke-width",m).attr("stroke",b).attr("fill","none"),p.selectAll(".sota-customBarChart-label-aboveBar-text").data(a).join("text").attr("x",(t,a)=>C[a][0]).attr("y",(t,a)=>B+A[a]*u);let $=t.max(A)*u+20,j=B+h.top+h.bottom+$;d.attr("height",j),p.attr("transform",`translate(${h.left} ${h.top})`).attr("width",f-h.left-h.right)})})},columnChart:function({selector:e,dataFile:n,inputIsPercentage:r=!1,displayPercentage:o=!0,totalResp:i=null,maxVal:c=null,minVal:h=null,mainHeight:d=a.mainHeight,showLegend:g=!1,margin:p={top:20,bottom:20,left:24,right:0}}){const f=a.overflowOffset,m=a.tickSize,x=a.labelAngle,u=a.swatch.between,b=a.swatch.right,y=a.swatch.width,w=a.swatch.height,v=a.swatch.belowBetween,B=a.swatch.below,k=t.select(e).append("svg"),C=t.select("body").append("div").attr("class","tooltip"),A=k.append("g").attr("class","sota-mainChart"),$=document.querySelector(e).offsetWidth,j=$-p.left-p.right;t.csv(n+".csv").then(a=>{const[n,G,M]=s(a,r,i),S=o||r?n:G;if(null===h)h=r||o?0:t.min(S);else if(!0===h)h=t.min(S);else if(isNaN(h)||""===h)throw"invalid minVal for graph on "+e;if(null===c)c=r||o?100:t.max(S);else if(!0===c)c=t.max(S);else if(isNaN(c)||""===c)throw"invalid maxVal for graph on "+e;const L=t.scaleBand().domain(M).range([0,j]).padding([.3]),P=t.scaleLinear().domain([h,c]).range([d,0]),N=t.scaleOrdinal().domain(M).range(t.map(M,(t,a)=>"module-fill-"+(a+1)).keys());let T,W=0,V=!1;if(g){let e=[];const n=k.append("g").lower().attr("class","sota-gen-legend").attr("transform",`translate(0 ${p.top})`);if(n.selectAll("nothing").data(a).enter().append("text").attr("class","sota-gen-legend-text").text(t=>t.label).attr("x",(function(){e.push(this.getBBox().width)})).remove(),t.sum(e,t=>t)+e.length*u+(e.length-1)*b>j){let a=j-t.max(e)-y-u;n.selectAll(".sota-gen-legend-swatch").data(M).join("rect").attr("class",t=>"sota-gen-legend-swatch "+N(t)).attr("x",a).attr("y",(t,a)=>(w+v)*a).attr("width",y).attr("height",w),n.selectAll(".sota-gen-legend-text").data(M).join("text").attr("class","sota-gen-legend-text sota-text-label").text(t=>t).attr("x",a+y+u).attr("y",(t,a)=>(w+v)*a+w/2).attr("alignment-baseline","central"),W=M.length*w+(M.length-1)*v+B}else{let a=j-(t.sum(e,t=>t)+M.length*(y+u)+(M.length-1)*b);n.selectAll(".sota-gen-legend-swatch").data(M).join("rect").attr("class",t=>"sota-gen-legend-swatch "+N(t)).attr("x",(n,l)=>a+l*(y+u+b)+t.sum(e.slice(0,l),t=>t)).attr("y",0).attr("width",y).attr("height",w),n.selectAll(".sota-gen-legend-text").data(M).join("text").attr("class","sota-gen-legend-text sota-text-label").text(t=>t).attr("x",(n,l)=>a+l*(y+u+b)+y+u+t.sum(e.slice(0,l),t=>t)).attr("y",w/2).attr("alignment-baseline","central"),W=w+B}}else{T=A.append("g").attr("class","sota-gen-axis sota-gen-xAxis sota-text-axis").call(t.axisBottom(L).tickSize(0)).attr("transform",`translate(0 ${d})`);const a=T.selectAll("text"),e=a.nodes();for(let t in e){if(t==e.length-1)continue;let a=e[+t].getBBox(),n=e[+t+1].getBBox();if(a.x+a.width>n.x){V=!0;break}}V&&a.attr("text-anchor","end").style("transform",`translateY(4px) rotate(-${x}deg)`).node().classList.add("angled-label")}A.append("g").attr("class","sota-gen-axis sota-gen-yAxis sota-num-axis").call(t.axisLeft(P).tickSize(-m));if(A.selectAll(".sota-columnChart-bar").data(S).join("rect").attr("class",(t,a)=>{let e="sota-columnChart-bar sota-gen-bar";return e+=g?" "+N(M[a]):"",e}).attr("x",(t,a)=>L(M[a])).attr("y",t=>P(t)).attr("width",L.bandwidth()).attr("height",t=>d-P(t)).call(l,C,n,M,G),g)d+=W;else if(V){let a=[];const e=T.select("text").node().getBBox(),n=e.y,l=e.height;T.selectAll("text").each((function(){a.push(this.getBBox().width)}));const s=t.max(a)*Math.sin(x*Math.PI/180),r=l*Math.cos(x*Math.PI/180);d+=n+s+r}else{let a=[];T.selectAll("text").each((function(){a.push(this.getBBox().y+this.getBBox().height)})),d+=+t.max(a)}let I=d+p.top+p.bottom;k.style("width",$+2*f+"px").attr("height",I).style("margin-left",-f),A.attr("transform",`translate(${p.left+f} ${p.top+W})`).attr("width",j)})},groupedBarChart:function({selector:e,dataFile:l,totalResp:s=null,inputIsPercentage:r=!1,displayPercentage:o=!0,minVal:i=0,maxVal:c=null,margin:h=a.margin}){const d=a.groupedBarChart.barHeight,g=a.groupedBarChart.barMargin,p=a.overflowOffset,f=a.groupLabelMargin,m=(a.swatch.between,a.swatch.right,a.swatch.width,a.swatch.height,a.swatch.belowBetween,a.swatch.below,a.xAxisTop),x=t.select(e).append("svg"),u=t.select("body").append("div").attr("class","tooltip"),b=x.append("g").attr("class","sota-mainChart"),y=document.querySelector(e).offsetWidth,w=y-h.left-h.right;t.csv(l+".csv").then(a=>{window.wow=a;const l=a.columns.splice(1),v=t.map(a,t=>t.group).keys(),B=t.map(a,a=>{let e=[];for(let t of l)e.push(+a[t]);return t.max(e)}).keys(),k=t.max(B,t=>+t);if(null==c)c=r||o?100:k;else if(isNaN(c)||""===c)throw"invalid maxVal for graph on "+e;const C=d+g,A=C*l.length;let $=(A+f)*a.length;const j=t.scaleLinear().domain([i,c]).range([0,w]),G=t.scaleOrdinal().domain(t.map(a,t=>t.group)).range(t.map(a,(t,a)=>(A+f)*a).keys()),M=t.scaleOrdinal().domain(l).range(t.map(l,(t,a)=>C*a).keys());b.append("g").attr("class","sota-gen-axis sota-gen-xAxis sota-groupedBarChart-xAxis sota-num-axis").call(t.axisBottom(j).tickSize(-($+m))).attr("transform","translate(0 "+($+m)+")");$+=20+m;const S=b.selectAll(".sota-groupedBarChart-group").data(a).join("g").attr("class","sota-groupedBarChart-group").attr("transform",(t,a)=>`translate(0 ${G(t.group)})`),L=t.scaleOrdinal().domain(l).range(t.map(l,(t,a)=>"module-fill-"+(a+1)).keys());S.selectAll(".sota-gen-bar").data(t=>{let a=[];for(let e of l)a.push(+t[e]);return a}).join("rect").attr("class",(t,a)=>"sota-gen-bar "+L(l[a])).attr("y",(t,a)=>+M(l[a])+ +f).attr("x",0).attr("width",(t,a)=>j(r?t:t/s[l[a]]*100)).attr("height",d).on("mouseover",(function(a,e){t.select(this).attr("opacity",.8),u.style("opacity",1).html(()=>{let t=`<span class="sota-text-label"><span class="sota-heavy-label">${l[e]}</span><br/>Percentage: ${n(r?a:a/s[l[e]]*100)}`;return r||(t+="<br/>Number of responses: "+a),t+="</span>",t}).style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")})).on("mousemove",()=>{u.style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(a){t.select(this).attr("opacity",1),u.style("opacity",0)})),b.selectAll(".sota-gen-groupLabel").data(v).join("text").attr("class","sota-gen-groupLabel sota-text-label sota-heavy-label").text(t=>t).attr("alignment-baseline","bottom").attr("x",0).attr("y",t=>+G(t)+ +f).attr("transform","translate(0 -8)");let P=$+h.top+h.bottom;x.style("width",y+2*p+"px").attr("height",P).style("margin-left",-p),b.attr("transform",`translate(${h.left+p} ${h.top})`).attr("width",w)})},stackedColumnChart:function({selector:e,dataFile:l,inputIsPercentage:s=!1,displayPercentage:r=!0,maxVal:o=null,minVal:i=null,mainHeight:c=a.mainHeight,margin:h={top:20,bottom:20,left:24,right:0}}){const d=a.tickSize,g=a.separatorStrokeWidth,p=a.overflowOffset,f=a.swatch.between,m=a.swatch.right,x=a.swatch.width,u=a.swatch.height,b=a.swatch.belowBetween,y=a.swatch.below,w=t.select(e).append("svg"),v=t.select("body").append("div").attr("class","tooltip"),B=w.append("g").attr("class","sota-stackedColumnChart-mainChart"),k=document.querySelector(e).offsetWidth,C=k-h.left-h.right;t.csv(l+".csv").then(a=>{const l=a.columns.slice(1),A=t.map(a,t=>t.group).keys();var $=[];s?a.forEach(t=>{let a=0,e=[];for(let n of l){let l=+t[n];e.push([l,a]),a+=l}$.push(e)}):a.forEach(a=>{let e=0,n=t.sum(l,t=>+a[t]),s=[];for(let t of l){let l=+a[t]/n*100;s.push([l,e,+a[t]]),e+=l}$.push(s)});const j=r||s?$:a.map(t=>+t.value);if(null===i)i=s||r?0:t.min(j);else if(!0===i)i=t.min(j);else if(isNaN(i)||""===i)throw"invalid minVal for graph on "+e;if(null===o)o=s||r?100:t.max(j);else if(!0===o)o=t.max(j);else if(isNaN(o)||""===o)throw"invalid maxVal for graph on "+e;const G=t.scaleBand().domain(A).range([0,C]).padding([.3]),M=t.scaleLinear().domain([i,o]).range([c,0]),S=t.scaleOrdinal().domain(l).range(t.map(l,(t,a)=>"module-fill-"+(a+1)).keys()),L=(B.append("g").attr("class","sota-gen-axis sota-gen-yAxis sota-num-axis").call(t.axisLeft(M).tickSize(-d)),B.append("g").attr("class","sota-gen-axis sota-gen-xAxis sota-text-axis").call(t.axisBottom(G).ticks(a.length).tickSize(-d)).attr("transform","translate(0 "+c+")"));let P=0,N=[];const T=w.append("g").lower().attr("class","sota-gen-legend").attr("transform",`translate(0 ${h.top})`);if(T.selectAll("nothing").data(l).enter().append("text").attr("class","sota-gen-legend-text sota-text-label sota-heavy-label").text(t=>t).attr("x",(function(){N.push(this.getBBox().width)})).remove(),t.sum(N,t=>t)+N.length*f+(N.length-1)*m>C){let a=C-t.max(N)-x-f;T.selectAll(".sota-gen-legend-swatch").data(l).join("rect").attr("class",t=>"sota-gen-legend-swatch "+S(t)).attr("x",a).attr("y",(t,a)=>(u+b)*a).attr("width",x).attr("height",u),T.selectAll(".sota-gen-legend-text").data(l).join("text").attr("class","sota-gen-legend-text sota-text-label sota-heavy-label").text(t=>t).attr("x",a+x+f).attr("y",(t,a)=>(u+b)*a+u/2).attr("alignment-baseline","central"),P=l.length*u+(l.length-1)*b+y}else{let a=C-(t.sum(N,t=>t)+l.length*(x+f)+(l.length-1)*m);T.selectAll(".sota-gen-legend-swatch").data(l).join("rect").attr("class",t=>"sota-gen-legend-swatch "+S(t)).attr("x",(e,n)=>a+n*(x+f+m)+t.sum(N.slice(0,n),t=>t)).attr("y",0).attr("width",x).attr("height",u),T.selectAll(".sota-gen-legend-text").data(l).join("text").attr("class","sota-gen-legend-text sota-text-label sota-heavy-label").text(t=>t).attr("x",(e,n)=>a+n*(x+f+m)+x+f+t.sum(N.slice(0,n),t=>t)).attr("y",u/2).attr("alignment-baseline","central"),P=u+y}const W=B.selectAll(".sota-stackedColumnChart-group").data($).join("g").attr("class","sota-stackedColumnChart-group").attr("transform",(t,a)=>"translate("+G(A[a])+" 0)");W.selectAll(".sota-stackedColumnChart-bar").data(t=>t).join("rect").attr("class",(t,a)=>"sota-stackedColumnChart-bar "+S(a)).attr("x",0).attr("y",t=>M(t[0]+t[1])).attr("width",G.bandwidth()).attr("height",t=>c-M(t[0])).on("mouseover",(function(a,e){t.select(this).attr("opacity",.8),v.style("opacity",1).html(()=>{let t=`<span class="sota-text-label"><span class="sota-heavy-label">${l[e]}</span><br/>Percentage: ${n(a[0])}`;return s||(t+="<br/>Number of responses: "+a[2]),t+="</span>",t}).style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")})).on("mousemove",()=>{v.style("left",t.event.pageX+"px").style("top",t.event.pageY+"px")}).on("mouseout",(function(a){t.select(this).attr("opacity",1),v.style("opacity",0)})),W.selectAll(".sota-stackedColumnChart-separator").data(t=>t).join("rect").attr("class","sota-stackedColumnChart-separator").attr("fill","white").attr("x",0).attr("y",(t,a)=>M(t[0])+M(t[1])-c).attr("height",t=>t[0]>0?g:0).attr("width",G.bandwidth()),c+=P;{let a=[];L.selectAll("text").each((function(){a.push(this.getBBox().y+this.getBBox().height)})),c+=+t.max(a)}let V=c+h.top+h.bottom+P;w.style("width",k+2*p+"px").attr("height",V).style("margin-left",-p),B.attr("transform",`translate(${h.left+p} ${h.top+P})`).attr("width",C)})},setColors:function(t){let a="";for(const e in t){a+=`#${e}{\n            background-color: ${t[e][0]};\n            color: ${t[e][0]};\n            }\n            #${e} .sota-gen-bar{\n                fill: ${t[e][0]};\n            }\n            `;for(const n in t[e])a+=`\n            #${e} .module-fill-${+n+1}{\n                fill: ${t[e][n]};\n            }\n            `}document.head.appendChild(document.createElement("style")).textContent=a},setStyles:function(t,e=a){const n=e.separatorStrokeWidth,l=e.lineColor;let s=`\n@font-face {\n\tfont-family: "Gotham";\n\tfont-weight: 700;\n\tsrc: url("${t}/Gotham/GothamBold.ttf")\n}\n\n@font-face {\n\tfont-family: "Gotham";\n\tfont-weight: 700;\n\tfont-style: italic;\n\tsrc: url("${t}/Gotham/GothamBoldItalic.ttf")\n}\n\n@font-face {\n\tfont-family: "Gotham";\n\tsrc: url("${t}/Gotham/GothamBook.ttf")\n}\n\n@font-face {\n\tfont-family: "Gotham";\n\tfont-style: italic;\n\tsrc: url("${t}/Gotham/GothamBookItalic.ttf")\n}\n\n@font-face {\n\tfont-family: "Gotham";\n\tfont-weight: 300;\n\tsrc: url("${t}/Gotham/GothamLight.ttf")\n}\n\n@font-face {\n\tfont-family: "Gotham";\n\tfont-weight: 300;\n\tfont-style: italic;\n\tsrc: url("${t}/Gotham/GothamLightItalic.ttf")\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-Roman.otf");\n\tfont-weight: normal;\n\tfont-style: normal\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-Italic.otf");\n\tfont-weight: normal;\n\tfont-style: italic\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-Bold.otf");\n\tfont-weight: bold;\n\tfont-style: normal\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-BoldItalic.otf");\n\tfont-weight: bold;\n\tfont-style: italic\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-Semibold.otf");\n\tfont-weight: 600;\n\tfont-style: normal\n}\n\n@font-face {\n\tfont-family: 'Mercury Text G1';\n\tsrc: url("${t}/Mercury/MercuryTextG1-SemiboldItalic.otf");\n\tfont-weight: 600;\n\tfont-style: italic\n}\n\nbody{\n    margin: 0;\n}\n\nsection {\n\tpadding: 48px 0;\n\twidth: 100%\n}\n\nh1 {\n\tfont-size: 56px;\n\tfont-family: 'Gotham', sans-serif;\n\ttext-transform: uppercase;\n\tfont-weight: 700;\n\ttext-align: center;\n\tcolor: #fff\n}\n\n.container {\n    position: relative;\n\tmax-width: 1500px;\n\tbox-sizing: border-box;\n\tfont-family: "Gotham", Arial, sans-serif;\n\twidth: 100%;\n\tpadding: 48px 24px;\n\tmargin: 0 auto;\n\tdisplay: grid;\n\tcolumn-gap: 48px;\n\tbackground-color: #fff;\n\tgrid-template-columns: minmax(0, 1fr)\n}\n\n.container:before, .container:after{\n    pointer-events: none;\n    content: "";\n    position: absolute;\n    left: 0;\n    top: 32px;\n    height: calc(100% - 64px);\n    border-right: 1px solid rgba(0,0,0,0.1);\n    display: none;\n}\n\n.container .module-two-wide {\n\tgrid-column: 1/3\n}\n\n@media (min-width: 800px) {\n\t.container {\n\t\tgrid-template-columns: repeat(2, minmax(0, 1fr))\n\t}\n\n    .container:before{\n      width: 50%;\n      display: block;\n    }\n}\n\n@media (min-width: 1200px) {\n\t.container {\n\t\tgrid-template-columns: repeat(3, minmax(0, 1fr))\n\t}\n\n    .container:before{\n      width: 33.3%;\n    }\n    \n    .container:after{\n      width: 66.6%;\n      display: block;\n    }\n}\n\n.module {\n\tposition: relative;\n\twidth: 100%;\n\tborder-bottom: 1px solid rgba(0,0,0,0.2);\n\tmargin-bottom: 32px;\n}\n\n.module>svg {\n\twidth: 100%\n}\n\n.module h3 {\n\tfont-family: 'Gotham', sans-serif;\n\tfont-weight: 700;\n\ttext-transform: uppercase\n}\n\n.module .subtitle {\n\tfont-family: "Mercury Text G1", serif;\n\topacity: 0.4\n}\n\ntext{\n    fill: red;\n}\n\n.sota-heavy-label{\n    font-weight: 700;\n}\n\n.sota-num-label, .sota-num-axis .tick text{\n    font-family: "Gotham", sans-serif;\n    font-size: 14px;\n    fill: ${a.labelColor};\n}\n\n.sota-text-label, .sota-text-axis .tick text{\n    font-family: "Mercury Text G1", serif;\n    fill: black;\n}\n\n.sota-num-label.sota-stackedBarChart-label-onBar{\n    fill: rgba(255,255,255,0.6);\n}\n\n.tooltip {\n\tbackground-color: #222;\n\tcolor: #fff;\n\tpadding: 12px;\n\tposition: absolute;\n\tpointer-events: none;\n\topacity: 0;\n\ttransform: translate(-50%, -100%);\n\twhite-space: nowrap\n}\n\n.sota-gen-axis{\n    opacity: 0.4;\n}\n\n.sota-gen-axis.sota-gen-xAxis .tick text {\n\ttransform: translateY(4px);\n}\n\n.sota-gen-axis.sota-gen-yAxis .tick text {\n\ttransform: translateX(-8px);\n\ttext-anchor: end\n}\n\n.sota-gen-xAxis:not(.sota-text-axis) g.tick:first-of-type text:not(.angled-label){\n    text-anchor: start;\n}\n\n.sota-gen-xAxis:not(.sota-text-axis) g.tick:last-of-type text:not(.angled-label){\n    text-anchor: end;\n}\n\n.sota-gen-axis .tick line,\n.sota-gen-axis path.domain {\n\tstroke-width: ${n}px;\n\tstroke: ${l};\n}\n\n.sota-groupedBarChart-xAxis .tick line {\n\topacity: 0.2\n}\n\n.sota-big {\n\tfont-weight: 700;\n\tfont-size: 96px;\n\tline-height: 1.0;\n\tmargin-top: -8px;\n\tfont-family: "Mercury Text G1", serif\n}\n    `;document.head.appendChild(document.createElement("style")).textContent=s}};return i.sotaConfig=a,i.setParam=function(t,a){this.sotaConfig[t]=a},i.getParam=function(t){return this.sotaConfig[t]},i}));
